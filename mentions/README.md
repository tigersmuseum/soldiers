# Mentions of a soldier in source material
The purpose of the soldiers database is to uniquely identify a soldier. Having done that, you'll want to link the identity to mentions of the soldier in source records. How we do this at the Royal Hampshire Regiment museum is described below. The 'core' Soldiers database doesn't depend on anything here, so this can be considered an 'optional extra' - and there are doubtless other ways to achieve the same ends.

## What we do 
Our source data comes in various spreadsheet and documents. We convert these to Soldiers XML files and search against the database to see if the mentioned soldiers are already known. This process is described in the [format](/format) section of this repository. We check the Soldiers XML of any ambiguous or unidentified results for obvious transcription errors and make any necessary corrections. We make a judgement as to whether ambiguous results really do match one of soldiers in the database, perhaps editing the database as a result. Having done some suitable quality checks, we create new records in the database for the previously unknown soldiers; then repeat the search and filtering steps. Ideally, the result is a Soldiers XML file with a single **candidate** element attached to each **person** - but it might not be possible to uniquely identify everyone, and a few may remain ambiguous.

For each source, the Soldiers XML will have a canonical representation of name, rank and number, together with **notes** that depend on whatever additional information is specific to that source. We give each of the sources a short, memorable **source name**. We usually make one file of Soldiers XML for each source, but sometimes make more than one if the situation demands; dividing up otherwise unmanageably large files for example.

Source **person** records are identified to soldier by the presence of a single **candidate** element. Given a database *SID*, we can find all the related **person** elements, from all source files, and collect the source-specific **notes** elements together to create a *biography*. To help with this, we add a table to the database to map *SID* to source name, and create an XML file that maps source names to Soldiers XML files. See below.

## The data structures
We maintain a **sources.xml** XML file listing the source names and their corresponding Soldiers XML files. See [sources-template.xml](sources-template.xml) file for the structure of this document. We add a *[mentions](schema)* table to the database to relate database *SID* to source name.

### Populating the *mentions* table
We apply [sources-all.xsl](xsl/sources-all.xsl) to **sources.xml** to build a CSV file for import into the *mentions* table. See targets **make-mentions-csv** and **import-mentions** in [build-mentions.xml](build-mentions.xml).

The *mentions* table is constrained so that there can be only one record linking any one soldier to any one source name. If the mentions table is populated from a CSV file, and the CSV file is created by scanning through a Soldiers XML file, then this suggests that a soldier should appear only once in any one Soldiers XML file. This is not always practical, or even desirable. For example, casualty ledgers generate Soldiers XML files with a **person** element for each casualty record. If a soldier is injured several times, then there will be several **person** elements, each of which gets identified separately. One option is to post-process the Soldiers XML, after searching against the database, to consolidate all the **person** records with the same soldier ID into one. This is fine if the source data is complete, correct, and fully identifiable. In practise we can't be sure it's any of these things, so we leave the Soldiers XML as is, and select unique combinations of soldier ID and source name for inserting into the *mentions* table. We do this by loading the generated CSV into a temporary table that doesn't have the constraint, and then 'select distinct' from this table into *mentions*. See the **import-mentions-raw** target in [build-mentions.xml](build-mentions.xml).

## Item references
Some sources, the Commonwealth War Graves Commission for example, are backed by databases with their own unique soldier identifier that is used to construct a URL linking to the details for that soldier. We record this in the source-specific **notes** element, and copy it from there (if present) to the *ITEM_REF* field in the *mentions* table.